# Quick Link Management æµ‹è¯•æ–‡æ¡£

## æ¦‚è¿°

æœ¬é¡¹ç›®é‡‡ç”¨ **Vitest** ä½œä¸ºæµ‹è¯•æ¡†æ¶ï¼Œé…åˆ **Vue Test Utils** è¿›è¡Œ Vue ç»„ä»¶æµ‹è¯•ã€‚æµ‹è¯•è¦†ç›–äº†æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ç»„ä»¶ã€ç»„åˆå¼å‡½æ•°å’Œå·¥å…·å‡½æ•°ã€‚

## æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ setup.js                    # æµ‹è¯•ç¯å¢ƒé…ç½®
â”œâ”€â”€ utils/                      # æµ‹è¯•å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ testHelpers.js          # é€šç”¨æµ‹è¯•è¾…åŠ©å‡½æ•°
â””â”€â”€ unit/                       # å•å…ƒæµ‹è¯•
    â”œâ”€â”€ components/              # ç»„ä»¶æµ‹è¯•
    â”‚   â”œâ”€â”€ LinkForm.test.js     # é“¾æ¥è¡¨å•ç»„ä»¶æµ‹è¯•
    â”‚   â””â”€â”€ LinkItem.test.js     # é“¾æ¥é¡¹ç»„ä»¶æµ‹è¯•
    â””â”€â”€ composables/             # ç»„åˆå¼å‡½æ•°æµ‹è¯•
        â”œâ”€â”€ useLinks.test.js     # é“¾æ¥ç®¡ç†æµ‹è¯•
        â””â”€â”€ useStorage.test.js   # å­˜å‚¨ç®¡ç†æµ‹è¯•
```

## æµ‹è¯•è¦†ç›–ç‡

å½“å‰æµ‹è¯•è¦†ç›–ç‡ï¼š

| æ–‡ä»¶ | è¯­å¥è¦†ç›–ç‡ | åˆ†æ”¯è¦†ç›–ç‡ | å‡½æ•°è¦†ç›–ç‡ | è¡Œè¦†ç›–ç‡ |
|------|------------|------------|------------|----------|
| LinkForm.vue | 96.02% | 85.45% | 92.85% | 96.02% |
| LinkItem.vue | 97.2% | 71.42% | 100% | 97.2% |
| useLinks.js | 94.93% | 77.14% | 100% | 94.93% |
| useStorage.js | 94.89% | 84.61% | 100% | 94.89% |
| defaultLinks.js | 96.22% | 100% | 0% | 96.22% |

**æ€»ä½“è¦†ç›–ç‡**: 95%+ ğŸ¯

## è¿è¡Œæµ‹è¯•

### ä½¿ç”¨ npm è„šæœ¬

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
npm run test:run

# ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test

# å¯åŠ¨æµ‹è¯•UIç•Œé¢
npm run test:ui

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

### ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
./scripts/test.sh

# ç›‘å¬æ¨¡å¼
./scripts/test.sh watch

# æµ‹è¯•UIç•Œé¢
./scripts/test.sh ui

# è¦†ç›–ç‡æŠ¥å‘Š
./scripts/test.sh coverage

# æŸ¥çœ‹å¸®åŠ©
./scripts/test.sh help
```

## æµ‹è¯•ç±»å‹

### 1. ç»„ä»¶æµ‹è¯•

#### LinkForm ç»„ä»¶æµ‹è¯•
- âœ… ç»„ä»¶æ¸²æŸ“æµ‹è¯•
- âœ… ç¼–è¾‘æ¨¡å¼æµ‹è¯•
- âœ… è¡¨å•éªŒè¯æµ‹è¯•
- âœ… è¡¨å•æäº¤æµ‹è¯•
- âœ… è¡¨å•å–æ¶ˆæµ‹è¯•
- âœ… å®æ—¶éªŒè¯æµ‹è¯•

#### LinkItem ç»„ä»¶æµ‹è¯•
- âœ… ç»„ä»¶æ¸²æŸ“æµ‹è¯•
- âœ… Props éªŒè¯æµ‹è¯•
- âœ… äº‹ä»¶å¤„ç†æµ‹è¯•
- âœ… æ¡ä»¶æ¸²æŸ“æµ‹è¯•
- âœ… å›¾æ ‡æ˜¾ç¤ºæµ‹è¯•

### 2. ç»„åˆå¼å‡½æ•°æµ‹è¯•

#### useStorage æµ‹è¯•
- âœ… æ•°æ®è¯»å–æµ‹è¯•
- âœ… æ•°æ®å†™å…¥æµ‹è¯•
- âœ… æ•°æ®åˆ é™¤æµ‹è¯•
- âœ… é”™è¯¯å¤„ç†æµ‹è¯•
- âœ… è¾¹ç•Œæƒ…å†µæµ‹è¯•

#### useLinks æµ‹è¯•
- âœ… é“¾æ¥åˆ—è¡¨ç®¡ç†æµ‹è¯•
- âœ… æ·»åŠ é“¾æ¥æµ‹è¯•
- âœ… æ›´æ–°é“¾æ¥æµ‹è¯•
- âœ… åˆ é™¤é“¾æ¥æµ‹è¯•
- âœ… æœç´¢åŠŸèƒ½æµ‹è¯•
- âœ… æ•°æ®æŒä¹…åŒ–æµ‹è¯•

## æµ‹è¯•é…ç½®

### Vitest é…ç½® (`vitest.config.js`)

```javascript
import { defineConfig } from 'vitest/config'
import vue from '@vitejs/plugin-vue'
import { resolve } from 'path'

export default defineConfig({
  plugins: [vue()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.js'],
    // æ€§èƒ½ä¼˜åŒ–é…ç½®
    pool: 'threads',
    poolOptions: {
      threads: { singleThread: true }
    },
    // è¦†ç›–ç‡é…ç½®
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: ['node_modules/', 'tests/', '*.config.js', 'src/main.js']
    }
  },
  resolve: {
    alias: { '@': resolve(__dirname, './src') }
  }
})
```

### æµ‹è¯•ç¯å¢ƒé…ç½® (`tests/setup.js`)

- é…ç½®å…¨å±€æµ‹è¯•ç¯å¢ƒ
- Mock localStorage å’Œ window.open
- è®¾ç½®æµ‹è¯•å‰çš„æ¸…ç†å·¥ä½œ

### æµ‹è¯•å·¥å…·å‡½æ•° (`tests/utils/testHelpers.js`)

æä¾›å¸¸ç”¨çš„æµ‹è¯•è¾…åŠ©å‡½æ•°ï¼š
- `waitForUpdate()` - ç­‰å¾…Vueç»„ä»¶æ›´æ–°
- `createMockLink()` - åˆ›å»ºæ¨¡æ‹Ÿé“¾æ¥æ•°æ®
- `fillForm()` - æ¨¡æ‹Ÿè¡¨å•è¾“å…¥
- `expectEventEmitted()` - éªŒè¯äº‹ä»¶è§¦å‘
- `createMockStorage()` - åˆ›å»ºæ¨¡æ‹Ÿå­˜å‚¨

## æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- é‡‡ç”¨ "åº”è¯¥..." çš„æ ¼å¼
- æŒ‰åŠŸèƒ½æ¨¡å—åˆ†ç»„

### 2. æµ‹è¯•ç»“æ„
- **Arrange**: å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
- **Act**: æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
- **Assert**: éªŒè¯ç»“æœ

### 3. Mock ç­–ç•¥
- å¯¹å¤–éƒ¨ä¾èµ–è¿›è¡Œ Mock
- ä¿æŒ Mock çš„ç®€å•æ€§
- åœ¨æ¯ä¸ªæµ‹è¯•å‰é‡ç½® Mock

### 4. å¼‚æ­¥æµ‹è¯•
- ä½¿ç”¨ `async/await` å¤„ç†å¼‚æ­¥æ“ä½œ
- ç­‰å¾… DOM æ›´æ–°å®Œæˆ
- æ­£ç¡®å¤„ç† Promise å’Œäº‹ä»¶

ğŸ“– **è¯¦ç»†æŒ‡å—**: æŸ¥çœ‹ [æµ‹è¯•æœ€ä½³å®è·µæŒ‡å—](./testing-best-practices.md)

## æŒç»­é›†æˆ

æµ‹è¯•å¯ä»¥é›†æˆåˆ° CI/CD æµç¨‹ä¸­ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Tests
  run: npm run test:run

- name: Generate Coverage
  run: npm run test:coverage
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æµ‹è¯•è¶…æ—¶**
   - æ£€æŸ¥å¼‚æ­¥æ“ä½œæ˜¯å¦æ­£ç¡®ç­‰å¾…
   - å¢åŠ æµ‹è¯•è¶…æ—¶æ—¶é—´

2. **DOM å…ƒç´ æ‰¾ä¸åˆ°**
   - ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ `data-testid`
   - ç­‰å¾… DOM æ›´æ–°å®Œæˆ

3. **Mock ä¸ç”Ÿæ•ˆ**
   - æ£€æŸ¥ Mock çš„è®¾ç½®æ—¶æœº
   - ç¡®ä¿åœ¨æ­£ç¡®çš„ä½œç”¨åŸŸå†…

### è°ƒè¯•æŠ€å·§

```javascript
// æ‰“å°ç»„ä»¶ HTML
console.log(wrapper.html())

// æ‰“å°è§¦å‘çš„äº‹ä»¶
console.log(wrapper.emitted())

// æ£€æŸ¥ç»„ä»¶çŠ¶æ€
console.log(wrapper.vm.$data)
```

## æ‰©å±•æµ‹è¯•

æ·»åŠ æ–°æµ‹è¯•æ—¶ï¼Œè¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. åœ¨ç›¸åº”ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. å¯¼å…¥å¿…è¦çš„æµ‹è¯•å·¥å…·
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹
4. è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡
5. æ›´æ–°æ–‡æ¡£

## è´¨é‡æŒ‡æ ‡

### è¦†ç›–ç‡ç›®æ ‡
- **è¯­å¥è¦†ç›–ç‡**: â‰¥ 90% âœ…
- **åˆ†æ”¯è¦†ç›–ç‡**: â‰¥ 80% âœ…
- **å‡½æ•°è¦†ç›–ç‡**: â‰¥ 90% âœ…
- **è¡Œè¦†ç›–ç‡**: â‰¥ 90% âœ…

### æµ‹è¯•è´¨é‡
- **52ä¸ªæµ‹è¯•ç”¨ä¾‹** å…¨éƒ¨é€šè¿‡ âœ…
- **é›¶æµ‹è¯•å¤±è´¥** âœ…
- **å¿«é€Ÿæ‰§è¡Œ** (< 5ç§’) âœ…

---

*æœ€åæ›´æ–°: 2024å¹´* 