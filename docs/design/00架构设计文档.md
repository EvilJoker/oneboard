# OneBoard 架构设计文档 v2

## 1. 项目概述
**技术特性**：
- 零后端依赖
- 支持PWA离线运行
- 数据版本化迁移

## 2. 技术架构
```mermaid
graph LR
    A[Vue 3] --> B[Composition API]
    C[Vite] --> D[构建优化]
    E[Tailwind] --> F[响应式布局]
    G[Pinia] --> H[状态共享]
    I[localStorage] --> J[数据持久化]
    K[Vitest] --> L[测试覆盖]
```

## 3. 测试架构

### 3.1 测试策略
```mermaid
graph TD
    A[测试金字塔] --> B[单元测试 70%]
    A --> C[集成测试 20%]
    A --> D[E2E测试 10%]
    
    B --> E[组件测试]
    B --> F[组合式函数测试]
    B --> G[工具函数测试]
    
    C --> H[组件交互测试]
    C --> I[数据流测试]
```

### 3.2 测试工具链
- **测试框架**: Vitest (快速、现代)
- **组件测试**: Vue Test Utils
- **模拟环境**: jsdom
- **覆盖率**: v8 provider
- **目标覆盖率**: 95%+

### 3.3 测试分层
| 测试层级 | 工具 | 覆盖范围 | 执行频率 |
|---------|------|----------|----------|
| 单元测试 | Vitest + Vue Test Utils | 组件、函数 | 每次提交 |
| 集成测试 | Vitest | 模块交互 | 每次构建 |
| E2E测试 | (预留) | 用户流程 | 发布前 |

## 4. 模块设计

### 4.1 快捷链接模块
- **数据版本控制**：
  ```typescript
  interface StorageSchema {
    _version: '1.0'
    links: QuickLink[]
  }
  ```
- **错误边界**：
  - 无效URL自动过滤
  - 重复链接提示

### 4.2 任务管理模块
新增状态机设计：
```mermaid
stateDiagram-v2
    [*] --> Idle
    Idle --> Loading: 初始化
    Loading --> Ready: 成功
    Loading --> Error: 失败
    Ready --> Saving: 修改数据
    Saving --> Ready: 保存成功
    Saving --> Error: 保存失败
```

## 5. 交互流程
```mermaid
sequenceDiagram
    participant User
    participant LinkPanel
    participant useLinks
    participant localStorage
    
    User->>LinkPanel: 点击新增
    LinkPanel->>useLinks: validateLink(link)
    useLinks-->>LinkPanel: 校验结果
    LinkPanel->>useLinks: saveLink(link)
    useLinks->>localStorage: 写入数据
    localStorage-->>useLinks: 操作状态
    useLinks-->>LinkPanel: 更新状态
    LinkPanel-->>User: 显示反馈
```

## 6. 项目结构（更新）
```
src/
├── components/
│ ├── links/ # 链接相关组件
│ └── tasks/ # 任务相关组件
├── composables/ # 组合式函数
│ ├── useStorage.js # 基础存储操作
│ ├── useLinks.js # 链接业务逻辑
│ └── useTasks.js # 任务业务逻辑
├── constants/ # 常量数据
│ └── defaultLinks.js # 默认链接配置
├── stores/ # Pinia状态管理
└── assets/ # 静态资源

tests/ # 测试目录
├── setup.js # 测试环境配置
├── utils/ # 测试工具函数
│ └── testHelpers.js
└── unit/ # 单元测试
  ├── components/ # 组件测试
  │ ├── LinkForm.test.js
  │ └── LinkItem.test.js
  └── composables/ # 组合式函数测试
    ├── useStorage.test.js
    └── useLinks.test.js

docs/ # 文档目录
├── design/ # 设计文档
├── testing.md # 测试指南
└── testing-best-practices.md # 测试最佳实践
```

## 7. 技术决策表
| 领域        | 方案                | 备选方案           |
|------------|--------------------|-------------------|
| 表单验证     | 原生URL API        | zod               |
| 图标方案     | Heroicons SVG      | 图标字体           |
| 异常处理     | 错误边界组件        | try/catch全局处理  |
| 测试框架     | Vitest             | Jest              |
| 组件测试     | Vue Test Utils     | Testing Library   |
| 测试环境     | jsdom              | happy-dom         |
| 覆盖率工具   | v8 provider        | c8                |

## 8. 扩展性考虑
1. 未来可接入浏览器书签API
2. 支持导出/导入数据（JSON格式）
3. 主题切换能力预留

## 技术架构
+ 组件库: @headlessui/vue (按需引入)

## 5.2 组件库选型
- 基础交互组件：@headlessui/vue
- 图标方案：使用原生SVG或[heroicons](https://heroicons.com/)

### 数据持久化策略
- 版本控制：通过`_version`字段实现数据迁移
- 默认数据：内置常见开发工具链接（GitHub/Jira等）
